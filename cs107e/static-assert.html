<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>_Static_assert 是干什么用的</title><meta name="description" content="_Static_assert，在uart.c里面如何使用的">
    <link rel="preload" href="/assets/style-5ca28362.css" as="style"><link rel="stylesheet" href="/assets/style-5ca28362.css">
    <link rel="modulepreload" href="/assets/app-4ee05d6f.js"><link rel="modulepreload" href="/assets/framework-5866ffd3.js"><link rel="modulepreload" href="/assets/static-assert.html-c06b832d.js"><link rel="modulepreload" href="/assets/static-assert.html-40271eda.js"><link rel="prefetch" href="/assets/index.html-c4c1d27a.js" as="script"><link rel="prefetch" href="/assets/1st-week.html-fe68f33f.js" as="script"><link rel="prefetch" href="/assets/cs107e-risc-v.html-9057ed1f.js" as="script"><link rel="prefetch" href="/assets/index.html-1720408f.js" as="script"><link rel="prefetch" href="/assets/lab1.html-a12869c0.js" as="script"><link rel="prefetch" href="/assets/mangopi.html-7cee1c11.js" as="script"><link rel="prefetch" href="/assets/uart_c.html-694445c6.js" as="script"><link rel="prefetch" href="/assets/helloVuePress.html-7582c42c.js" as="script"><link rel="prefetch" href="/assets/index.html-74580d32.js" as="script"><link rel="prefetch" href="/assets/podman-compose.html-1a3c442f.js" as="script"><link rel="prefetch" href="/assets/reactiveArrayByObjectInVue3.html-7ba34a2a.js" as="script"><link rel="prefetch" href="/assets/reinstallArchlinux.html-1f4babca.js" as="script"><link rel="prefetch" href="/assets/spring-boot-parent.html-68d421db.js" as="script"><link rel="prefetch" href="/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/assets/index.html-ac945222.js" as="script"><link rel="prefetch" href="/assets/1st-week.html-fb315f42.js" as="script"><link rel="prefetch" href="/assets/cs107e-risc-v.html-9d0b5c65.js" as="script"><link rel="prefetch" href="/assets/index.html-521e993d.js" as="script"><link rel="prefetch" href="/assets/lab1.html-25dff2cb.js" as="script"><link rel="prefetch" href="/assets/mangopi.html-ef0382da.js" as="script"><link rel="prefetch" href="/assets/uart_c.html-5cde96fe.js" as="script"><link rel="prefetch" href="/assets/helloVuePress.html-6192dc8e.js" as="script"><link rel="prefetch" href="/assets/index.html-0bdf0b2a.js" as="script"><link rel="prefetch" href="/assets/podman-compose.html-b49c5fc9.js" as="script"><link rel="prefetch" href="/assets/reactiveArrayByObjectInVue3.html-d11ac275.js" as="script"><link rel="prefetch" href="/assets/reinstallArchlinux.html-0138f7f9.js" as="script"><link rel="prefetch" href="/assets/spring-boot-parent.html-03bde350.js" as="script"><link rel="prefetch" href="/assets/404.html-87d54bd8.js" as="script"><link rel="prefetch" href="/assets/giscus-9b97f17f.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><!--v-if--></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/til" class="" aria-label="TodayILearn"><!--[--><!--]--> TodayILearn <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/til" class="" aria-label="TodayILearn"><!--[--><!--]--> TodayILearn <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="static-assert" tabindex="-1"><a class="header-anchor" href="#static-assert" aria-hidden="true">#</a> _Static_assert</h1><p>_Static_assert()接受两个参数，如果第一个参数是<code>false</code>，则编译器显示第二个参数，并且编译失败。</p><h1 id="例子" tabindex="-1"><a class="header-anchor" href="#例子" aria-hidden="true">#</a> 例子</h1><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">// structs defined to match layout of hardware registers</span>
<span class="token keyword">typedef</span> <span class="token keyword">union</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token keyword">union</span> <span class="token punctuation">{</span>
            <span class="token class-name">uint32_t</span> rbr<span class="token punctuation">;</span>   <span class="token comment">// receive buffer register</span>
            <span class="token class-name">uint32_t</span> thr<span class="token punctuation">;</span>   <span class="token comment">// transmit holding register</span>
            <span class="token class-name">uint32_t</span> dll<span class="token punctuation">;</span>   <span class="token comment">// divisor latch (LSB)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">union</span> <span class="token punctuation">{</span>
            <span class="token class-name">uint32_t</span> dlh<span class="token punctuation">;</span>   <span class="token comment">// divisor latch (MSB)</span>
            <span class="token class-name">uint32_t</span> ier<span class="token punctuation">;</span>   <span class="token comment">// interrupt enable register</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">union</span> <span class="token punctuation">{</span>
            <span class="token class-name">uint32_t</span> iir<span class="token punctuation">;</span>   <span class="token comment">// interrupt identification register</span>
            <span class="token class-name">uint32_t</span> fcr<span class="token punctuation">;</span>   <span class="token comment">// FIFO control register</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">uint32_t</span> lcr<span class="token punctuation">;</span>       <span class="token comment">// line control register</span>
        <span class="token class-name">uint32_t</span> mcr<span class="token punctuation">;</span>       <span class="token comment">// modem control register</span>
        <span class="token class-name">uint32_t</span> lsr<span class="token punctuation">;</span>       <span class="token comment">// line status register</span>
        <span class="token class-name">uint32_t</span> reserved<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">uint32_t</span> usr<span class="token punctuation">;</span>       <span class="token comment">// busy status, at offset 0x7c</span>
        <span class="token class-name">uint32_t</span> reserved2<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">uint32_t</span> halt<span class="token punctuation">;</span>      <span class="token comment">// at offset 0xa4</span>
    <span class="token punctuation">}</span> regs<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> padding<span class="token punctuation">[</span><span class="token number">0x400</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">uart_t</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">UART_BASE</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uart_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x02500000</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">_Static_assert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>UART_BASE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>regs<span class="token punctuation">.</span>lcr<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x0250000C</span><span class="token punctuation">,</span> <span class="token string">&quot;UART0 lcr reg must be at address 0x0250000C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">_Static_assert</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>UART_BASE<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>regs<span class="token punctuation">.</span>dlh<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token class-name">uint32_t</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x02500404</span><span class="token punctuation">,</span> <span class="token string">&quot;UART1 dlh reg must be at address 0x02500404&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="为什么是0x02500000" tabindex="-1"><a class="header-anchor" href="#为什么是0x02500000" aria-hidden="true">#</a> 为什么是<code>0x02500000</code>？</h2><p>就是硬件地址，37MB地址的位置，d1-h_user_manual如下</p><p><img src="/assets/image-20240112104825058-d6a5b9b5.png" alt="image-20240112104825058"></p><h2 id="为什么硬件地址是共用体union类型" tabindex="-1"><a class="header-anchor" href="#为什么硬件地址是共用体union类型" aria-hidden="true">#</a> 为什么硬件地址是共用体<code>union</code>类型？</h2><p><code>union</code> 实现了让同一个地址当作不同的类型使用，所以uart_t 既可以看做是结构体 <code>regs</code> ，来控制串口寄存器，也可以看做<code>0x400 == 1KB</code>的占位，这样可以可以简单用uart_t[6]数组代表6个UART，</p><p><img src="/assets/image-20240112105526118-f4953b76.png" alt="image-20240112105526118"></p><h2 id="static-assert-在这里的作用" tabindex="-1"><a class="header-anchor" href="#static-assert-在这里的作用" aria-hidden="true">#</a> _Static_assert 在这里的作用</h2><ul><li><code>#define UART_BASE ((uart_t *)0x02500000)</code>: <code>UART_BASE</code> 是一个指针，存储 <code>0x02500000</code>，类型是 <code>uart_t</code></li><li><code>UART_BASE[0]</code>: <code>0x02500000</code> 这个地址存储的值，union 类型，主要使用的是结构体<code>reg</code>代表的寄存器</li><li><code>UART_BASE[0].regs</code>: 使用struct类型的变量，通过改变<code>UART_BASE[0].regs</code>的值可以控制串口寄存器，或读取串口寄存器内容</li><li><code>&amp;(UART_BASE[0].regs.lcr)</code>: 读取<code>lcr</code>这个偏移量的地址</li><li><code>&amp;(UART_BASE[0].regs.lcr) == (uint32_t *)0x0250000C</code>: 判断 UART0的寄存器UART_LCR的地址是否是<code>0x0250000C</code></li><li><code>_Static_assert</code>: 硬件地址分配没有错，这此就能编译下去</li></ul><h2 id="没有意义" tabindex="-1"><a class="header-anchor" href="#没有意义" aria-hidden="true">#</a> 没有意义</h2><p>现在的知识无法理解为什么加_Static_assert的判断。因为以上代码的写法不会出现编译错误的情况。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: jiyilc.sd@chinatelecom.cn">Jiyi</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-4ee05d6f.js" defer></script>
  </body>
</html>
