<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>自用archlinux装机指南</title><meta name="description" content="备份用装机指南，自用linux工作电脑，intel cpu，nvidia亮机卡。个人偏好，使用德沃夏克键盘布局，btrfs，xfce，kitty，fish">
    <link rel="preload" href="/assets/style-5ca28362.css" as="style"><link rel="stylesheet" href="/assets/style-5ca28362.css">
    <link rel="modulepreload" href="/assets/app-4ee05d6f.js"><link rel="modulepreload" href="/assets/framework-5866ffd3.js"><link rel="modulepreload" href="/assets/reinstallArchlinux.html-0138f7f9.js"><link rel="modulepreload" href="/assets/reinstallArchlinux.html-1f4babca.js"><link rel="prefetch" href="/assets/index.html-c4c1d27a.js" as="script"><link rel="prefetch" href="/assets/1st-week.html-fe68f33f.js" as="script"><link rel="prefetch" href="/assets/cs107e-risc-v.html-9057ed1f.js" as="script"><link rel="prefetch" href="/assets/index.html-1720408f.js" as="script"><link rel="prefetch" href="/assets/lab1.html-a12869c0.js" as="script"><link rel="prefetch" href="/assets/mangopi.html-7cee1c11.js" as="script"><link rel="prefetch" href="/assets/static-assert.html-40271eda.js" as="script"><link rel="prefetch" href="/assets/uart_c.html-694445c6.js" as="script"><link rel="prefetch" href="/assets/helloVuePress.html-7582c42c.js" as="script"><link rel="prefetch" href="/assets/index.html-74580d32.js" as="script"><link rel="prefetch" href="/assets/podman-compose.html-1a3c442f.js" as="script"><link rel="prefetch" href="/assets/reactiveArrayByObjectInVue3.html-7ba34a2a.js" as="script"><link rel="prefetch" href="/assets/spring-boot-parent.html-68d421db.js" as="script"><link rel="prefetch" href="/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/assets/index.html-ac945222.js" as="script"><link rel="prefetch" href="/assets/1st-week.html-fb315f42.js" as="script"><link rel="prefetch" href="/assets/cs107e-risc-v.html-9d0b5c65.js" as="script"><link rel="prefetch" href="/assets/index.html-521e993d.js" as="script"><link rel="prefetch" href="/assets/lab1.html-25dff2cb.js" as="script"><link rel="prefetch" href="/assets/mangopi.html-ef0382da.js" as="script"><link rel="prefetch" href="/assets/static-assert.html-c06b832d.js" as="script"><link rel="prefetch" href="/assets/uart_c.html-5cde96fe.js" as="script"><link rel="prefetch" href="/assets/helloVuePress.html-6192dc8e.js" as="script"><link rel="prefetch" href="/assets/index.html-0bdf0b2a.js" as="script"><link rel="prefetch" href="/assets/podman-compose.html-b49c5fc9.js" as="script"><link rel="prefetch" href="/assets/reactiveArrayByObjectInVue3.html-d11ac275.js" as="script"><link rel="prefetch" href="/assets/spring-boot-parent.html-03bde350.js" as="script"><link rel="prefetch" href="/assets/404.html-87d54bd8.js" as="script"><link rel="prefetch" href="/assets/giscus-9b97f17f.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><!--v-if--></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/til" class="router-link-active" aria-label="TodayILearn"><!--[--><!--]--> TodayILearn <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/til" class="router-link-active" aria-label="TodayILearn"><!--[--><!--]--> TodayILearn <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="台式机安装archlinux" tabindex="-1"><a class="header-anchor" href="#台式机安装archlinux" aria-hidden="true">#</a> 台式机安装archlinux</h1><p>备份用装机指南，自用linux工作电脑，intel cpu，nvidia亮机卡，两个硬盘，一个固态，一个机械。<br> 个人偏好明显，使用德沃夏克键盘布局，btrfs，xfce，kitty，fish</p><h2 id="ventoy-进入livecd" tabindex="-1"><a class="header-anchor" href="#ventoy-进入livecd" aria-hidden="true">#</a> ventoy 进入liveCD</h2><h3 id="改变键盘布局" tabindex="-1"><a class="header-anchor" href="#改变键盘布局" aria-hidden="true">#</a> 改变键盘布局</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>loadkeys dvorak
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="上网" tabindex="-1"><a class="header-anchor" href="#上网" aria-hidden="true">#</a> 上网</h3><p>自动获取IP的网络什么都不用管，直接上网</p><h4 id="手动ip" tabindex="-1"><a class="header-anchor" href="#手动ip" aria-hidden="true">#</a> 手动ip</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ip</span> <span class="token function">link</span>
<span class="token function">ip</span> address <span class="token function">add</span> <span class="token number">192.168</span>.11.2/26 dev enp3s0
<span class="token function">ip</span> route <span class="token function">add</span> default via <span class="token number">192.168</span>.11.1 dev enp3s0
<span class="token function">vim</span> /etc/resolv.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nameserver <span class="token number">114.114</span>.114.114
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ssh" tabindex="-1"><a class="header-anchor" href="#ssh" aria-hidden="true">#</a> ssh</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">passwd</span> <span class="token comment"># 设置root密码，相同局域网的其他电脑就可以远程安装了</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="时间同步" tabindex="-1"><a class="header-anchor" href="#时间同步" aria-hidden="true">#</a> 时间同步</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>timedatectl set-ntp <span class="token boolean">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="分区" tabindex="-1"><a class="header-anchor" href="#分区" aria-hidden="true">#</a> 分区</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">fdisk</span> <span class="token parameter variable">-l</span> <span class="token comment"># 查看分区情况</span>
<span class="token function">fdisk</span> /dev/nvme0n1 <span class="token comment"># 对磁盘进行分区</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>800M boot+efi 20G swap，因为16G内存，未来如果做休眠用的到 剩下的 linux 因为使用systemd-boot启动，内核放到btrfs做起来有点麻烦，所以内核还是放在fat32里面</p></blockquote><h3 id="格式化" tabindex="-1"><a class="header-anchor" href="#格式化" aria-hidden="true">#</a> 格式化</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mkfs.fat <span class="token parameter variable">-F</span> <span class="token number">32</span> /dev/nvme0n1p1 <span class="token comment"># boot 分区</span>
<span class="token function">mkswap</span> /dev/nvme0n1p2 <span class="token comment"># swap 分区</span>
mkfs.btrfs <span class="token parameter variable">-L</span> mylabel <span class="token parameter variable">-f</span> /dev/nvme0n1p3 <span class="token comment"># 使用btrfs</span>
<span class="token comment"># -f: --force force overwrite</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="btrfs" tabindex="-1"><a class="header-anchor" href="#btrfs" aria-hidden="true">#</a> Btrfs</h3><h4 id="选项一-新建分区" tabindex="-1"><a class="header-anchor" href="#选项一-新建分区" aria-hidden="true">#</a> 选项一：新建分区</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> /mnt/btrfs
<span class="token function">mount</span> /dev/nvme0n1p3 /mnt/btrfs

<span class="token comment"># 可以简写为 btrfs sub cr </span>
btrfs subvolume create /mnt/btrfs/@
btrfs subvolume create /mnt/btrfs/@home
btrfs subvolume create /mnt/btrfs/@logs
btrfs subvolume create /mnt/btrfs/@pkgs

<span class="token comment"># 可以简写为 btrfs sub li</span>
btrfs subvolume list /mnt/btrfs

<span class="token function">mkdir</span> /mnt/arch
<span class="token function">mount</span> <span class="token parameter variable">-o</span> noatime,nodiratime,compress<span class="token operator">=</span>zstd,subvol<span class="token operator">=</span>@ /dev/nvme0n1p3 /mnt/arch
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /mnt/arch/mnt/btrfs-root
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /mnt/arch/home
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /mnt/arch/var/cache/pacman
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /mnt/arch/var/log

<span class="token function">mount</span> <span class="token parameter variable">-o</span> noatime,nodiratime,compress<span class="token operator">=</span>zstd,subvol<span class="token operator">=</span>@home /dev/nvme0n1p3 /mnt/arch/home
<span class="token function">mount</span> <span class="token parameter variable">-o</span> noatime,nodiratime,compress<span class="token operator">=</span>zstd,subvol<span class="token operator">=</span>@logs /dev/nvme0n1p3 /mnt/arch/var/log
<span class="token function">mount</span> <span class="token parameter variable">-o</span> noatime,nodiratime,compress<span class="token operator">=</span>zstd,subvol<span class="token operator">=</span>@pkgs /dev/nvme0n1p3 /mnt/arch/var/cache/pacman
<span class="token function">mount</span> <span class="token parameter variable">-o</span> noatime,nodiratime,compress<span class="token operator">=</span>zstd,subvol<span class="token operator">=</span>/ /dev/nvme0n1p3 /mnt/arch/mnt/btrfs-root
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="选项二-原来就是btrfs格式-未格式化" tabindex="-1"><a class="header-anchor" href="#选项二-原来就是btrfs格式-未格式化" aria-hidden="true">#</a> 选项二：原来就是btrfs格式，未格式化</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>btrfs subvolume snapshot /mnt/btrfs/@ /mnt/btrfs/@backup_root <span class="token comment"># 对原root分区做快照</span>
btrfs subvolume delete /mnt/btrfs/@ <span class="token comment"># 删除原分区</span>
btrfs subvolume create /mnt/btrfs/@ <span class="token comment"># 新建root分区</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="其他分区" tabindex="-1"><a class="header-anchor" href="#其他分区" aria-hidden="true">#</a> 其他分区</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mount</span> /dev/nvme0n1p1 /mnt/arch/boot
<span class="token function">swapon</span> /dev/nvme0n1p2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装包" tabindex="-1"><a class="header-anchor" href="#安装包" aria-hidden="true">#</a> 安装包</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>pacstrap /mnt base base-devel linux linux-headers linux-firmware
pacstrap /mnt <span class="token function">vim</span> btrfs-progs openssh intel-ucode <span class="token function">git</span> fish
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 如果遇到了unknown trust错误，用以下命令</span>
pacman <span class="token parameter variable">-Sy</span> archlinux-keyring
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生成分区文件" tabindex="-1"><a class="header-anchor" href="#生成分区文件" aria-hidden="true">#</a> 生成分区文件</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>genfstab <span class="token parameter variable">-U</span> /mnt/arch <span class="token operator">&gt;&gt;</span> /mnt/arch/etc/fstab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="进入chroot" tabindex="-1"><a class="header-anchor" href="#进入chroot" aria-hidden="true">#</a> 进入chroot</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>arch-chroot /mnt/arch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="时区" tabindex="-1"><a class="header-anchor" href="#时区" aria-hidden="true">#</a> 时区</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ln</span> <span class="token parameter variable">-sf</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
hwclock <span class="token parameter variable">--systohc</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="语言" tabindex="-1"><a class="header-anchor" href="#语言" aria-hidden="true">#</a> 语言</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/locale.gen
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>en_US.UTF-8 UTF-8
zh_CN.UTF-8 UTF-8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>locale-gen
<span class="token function">vim</span> /etc/locale.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_US.UTF-8 <span class="token comment"># 命令行界面使用英文，因为中文显示不正常</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="设置键盘" tabindex="-1"><a class="header-anchor" href="#设置键盘" aria-hidden="true">#</a> 设置键盘</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/vconsole.conf <span class="token comment"># 设置命令行界面的键盘布局</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">KEYMAP</span><span class="token operator">=</span>dvorak
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="主机名" tabindex="-1"><a class="header-anchor" href="#主机名" aria-hidden="true">#</a> 主机名</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/hostname
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>arch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/hosts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1 localhost
::1 localhost
<span class="token number">127.0</span>.1.1 ctarch.localdomain arch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="内核模块" tabindex="-1"><a class="header-anchor" href="#内核模块" aria-hidden="true">#</a> 内核模块</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/mkinitcpio.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>添加 btrfs 到 MODULES=(...)行和HOOKS=(...)行</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">MODULES</span><span class="token operator">=</span><span class="token punctuation">(</span>btrfs<span class="token punctuation">)</span>
<span class="token assign-left variable">HOOKS</span><span class="token operator">=</span><span class="token punctuation">(</span>base udev autodetect modconf block filesystems keyboard <span class="token function">fsck</span> btrfs<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mkinitcpio <span class="token parameter variable">-p</span> linux
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="systemd-boot" tabindex="-1"><a class="header-anchor" href="#systemd-boot" aria-hidden="true">#</a> systemd-boot</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>bootctl <span class="token function">install</span> <span class="token comment"># 默认安装到 /boot 中</span>
<span class="token function">ls</span> <span class="token parameter variable">-l</span> /dev/disk/by-something <span class="token comment"># 查询硬盘的label uuid 等信息</span>
<span class="token function">vim</span> /boot/loa<span class="token punctuation">]</span>der/entries/arch.conf <span class="token comment"># 上面查询到的写入，可以在此目录中放入多个启动文件，都能自动读取到</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>title Arch Linux
linux /vmlinuz-linux
initrd /intel-ucode.img
initrd /initramfs-linux.img
options <span class="token assign-left variable">root</span><span class="token operator">=</span>PARTUUID<span class="token operator">=</span>thth-ththt-th rw <span class="token assign-left variable">rootflags</span><span class="token operator">=</span>subvol<span class="token operator">=</span>@
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /boot/loader/loader.conf <span class="token comment"># 设置启动项</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>default arch.conf
<span class="token function">timeout</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="准备登录" tabindex="-1"><a class="header-anchor" href="#准备登录" aria-hidden="true">#</a> 准备登录</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">passwd</span> <span class="token comment"># root 密码</span>
<span class="token function">useradd</span> <span class="token parameter variable">-m</span> <span class="token parameter variable">-s</span> /usr/bin/fish jiyi <span class="token comment"># 使用fish作为默认shell</span>
<span class="token function">passwd</span> jiyi
<span class="token assign-left variable">EDITOR</span><span class="token operator">=</span>vim visudo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>jiyi <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL <span class="token comment"># sudo 不输入密码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="退出重启" tabindex="-1"><a class="header-anchor" href="#退出重启" aria-hidden="true">#</a> 退出重启</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">exit</span>
<span class="token function">umount</span> <span class="token parameter variable">-R</span> /mnt/arch
<span class="token function">umount</span> <span class="token parameter variable">-R</span> /mnt/btrfs
<span class="token function">reboot</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="进入新系统" tabindex="-1"><a class="header-anchor" href="#进入新系统" aria-hidden="true">#</a> 进入新系统</h2><p>普通用户登录，不用root</p><h3 id="上网-1" tabindex="-1"><a class="header-anchor" href="#上网-1" aria-hidden="true">#</a> 上网</h3><p>使用systemd-network</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> systemd-networkd.service
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> systemd-resolved.service
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/systemd/network/20-wired.network
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>Match<span class="token punctuation">]</span>
<span class="token assign-left variable">Name</span><span class="token operator">=</span>enp3s0

<span class="token punctuation">[</span>Network<span class="token punctuation">]</span>
<span class="token assign-left variable">Address</span><span class="token operator">=</span><span class="token number">192.168</span>.11.2/24
<span class="token assign-left variable">Gateway</span><span class="token operator">=</span><span class="token number">192.168</span>.11.1
<span class="token assign-left variable">DNS</span><span class="token operator">=</span><span class="token number">192.168</span>.11.1

<span class="token comment"># 或者用DHCP</span>
<span class="token comment"># DHCP=ipv4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="aur" tabindex="-1"><a class="header-anchor" href="#aur" aria-hidden="true">#</a> AUR</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>sudo vim /etc/pacman.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>archlinuxcn<span class="token punctuation">]</span>  
Server <span class="token operator">=</span> https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/<span class="token variable">$arch</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>去掉[multilib]一节中两行的注释，来开启 32 位库支持。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> archlinuxcn-keyring
<span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> yay
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="桌面用-xfce4-lightdm" tabindex="-1"><a class="header-anchor" href="#桌面用-xfce4-lightdm" aria-hidden="true">#</a> 桌面用[[xfce4]] + lightdm</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> xorg <span class="token comment"># all</span>
yay <span class="token parameter variable">-S</span> xfce4 <span class="token comment"># all</span>
yay <span class="token parameter variable">-S</span> xfce4-goodies <span class="token comment"># all</span>
yay <span class="token parameter variable">-S</span> gvfs <span class="token comment"># 用来自动挂盘</span>
yay <span class="token parameter variable">-S</span> lightdm lightdm-gtk-greeter lightdm-gtk-greeter-settings 
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> lightdm
yay <span class="token parameter variable">-S</span> pulseaudio <span class="token comment"># 声音</span>
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/lightdm/lightdm-gtk-greeter.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>greeter<span class="token punctuation">]</span>
indicators <span class="token operator">=</span> ~host<span class="token punctuation">;</span>~spacer<span class="token punctuation">;</span>~clock<span class="token punctuation">;</span>~spacer<span class="token punctuation">;</span>~layout<span class="token punctuation">;</span>~language<span class="token punctuation">;</span>~session<span class="token punctuation">;</span>~a11y<span class="token punctuation">;</span>~power
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="x11-键盘改布局" tabindex="-1"><a class="header-anchor" href="#x11-键盘改布局" aria-hidden="true">#</a> X11 键盘改布局</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> localectl --no-convert set-x11-keymap dvorak
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>改变了 <code>/etc/X11/xorg.conf.d/00-keyboard.cong</code> 文件</p></blockquote><h3 id="x11-桌面默认中文" tabindex="-1"><a class="header-anchor" href="#x11-桌面默认中文" aria-hidden="true">#</a> X11 桌面默认中文</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> .xprofile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>zh_CN.UTF-8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="应用" tabindex="-1"><a class="header-anchor" href="#应用" aria-hidden="true">#</a> 应用</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> clash-for-windows-bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>网络不行，可以从另一台电脑下载包，存储在 .cache/yay/clash-for-windows-bin/文件夹里面。 注意安装的时用的包名子和下载的包名字有区别</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> 1password
yay <span class="token parameter variable">-S</span> firefox firefox-i18n-zh-cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> zerotier-one
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> zerotier-one
<span class="token function">sudo</span> zerotier-cli <span class="token function">join</span> e533
<span class="token function">sudo</span> zerotier-cli orbit <span class="token number">2</span> <span class="token number">2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> visual-studio-code-bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> nutstore
yay <span class="token parameter variable">-S</span> remmina libvncserver freerdp <span class="token comment"># gnome-keyring 需要吗</span>
yay <span class="token parameter variable">-S</span> typora
yay <span class="token parameter variable">-S</span> logseq-desktop-bin <span class="token comment"># archlinuxcn 更新慢了两周</span>
yay <span class="token parameter variable">-S</span> google-chrome
yay <span class="token parameter variable">-S</span> gitahead-git <span class="token comment"># 依赖装了gnome-keyring</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="轨迹球" tabindex="-1"><a class="header-anchor" href="#轨迹球" aria-hidden="true">#</a> 轨迹球</h3><p>通过<code>xev</code>找到鼠标相应的按钮，通过<code>xbindkeys</code>和<code>xautomation</code>做功能绑定</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> xbindkeys xautomation
<span class="token builtin class-name">echo</span> <span class="token string">&quot;xbindkeys&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.xprofile
<span class="token function">vim</span> ~/.xbindkeysrc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 功能键代替中健</span>
<span class="token string">&quot;xte &#39;mouseclick 2&#39;&quot;</span>
b:12 + Release

<span class="token comment"># 功能键复制 </span>
<span class="token string">&quot;xte &#39;keydown Control_L&#39; &#39;key Insert&#39; &#39;keyup Control_L&#39;&quot;</span>
b:10 + Release

<span class="token comment"># 功能键粘贴</span>
<span class="token string">&quot;xte &#39;keydown Shift_L&#39; &#39;key Insert&#39; &#39;keyup Shift_L&#39;&quot;</span>
b:11 + Release
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="显卡" tabindex="-1"><a class="header-anchor" href="#显卡" aria-hidden="true">#</a> 显卡</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> nvidia-470xx-dkms nvidia-settings lib32-nvidia-470xx-utils
<span class="token function">sudo</span> <span class="token function">vim</span> /etc/mkinitcpio.conf <span class="token comment"># 删除掉`HOOKS`里面的`kms`</span>
<span class="token function">sudo</span> mkinitcpio <span class="token parameter variable">-p</span> linux
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="备用内核" tabindex="-1"><a class="header-anchor" href="#备用内核" aria-hidden="true">#</a> 备用内核</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> linux-lts linux-lts-headers
<span class="token function">sudo</span> <span class="token function">vim</span> /boot/loader/entries/arch-lts.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>title Arch Linux LTS
linux /vmlinuz-linux-lts
initrd /intel-ucode.img
initrd /initramfs-linux-lts.img
options <span class="token assign-left variable">root</span><span class="token operator">=</span>PARTUUID<span class="token operator">=</span>f0c651f5-3c90-cf42-91a9-cb51629e713e rw <span class="token assign-left variable">rootflags</span><span class="token operator">=</span>subvol<span class="token operator">=</span>@ nvidia-drm.modeset<span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ibt</span><span class="token operator">=</span>off
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="输入法" tabindex="-1"><a class="header-anchor" href="#输入法" aria-hidden="true">#</a> 输入法</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> fcitx5-im fcitx5-chinese-addons
<span class="token function">vim</span> ~/.xprofile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">INPUT_METHOD</span><span class="token operator">=</span>fcitx5
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GTK_IM_MODULE</span><span class="token operator">=</span>fcitx
<span class="token builtin class-name">export</span> <span class="token assign-left variable">QT_IM_MODULE</span><span class="token operator">=</span>fcitx
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">XMODIFIERS</span></span><span class="token operator">=</span>@im<span class="token operator">=</span>fcitx
<span class="token builtin class-name">export</span> <span class="token assign-left variable">GLFW_IM_MODULE</span><span class="token operator">=</span>ibus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="虚拟机" tabindex="-1"><a class="header-anchor" href="#虚拟机" aria-hidden="true">#</a> 虚拟机</h3><p>先设置桥接，让虚拟机与宿主用同一个网络</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># /etc/systemd/network/br0.netdev</span>
<span class="token punctuation">[</span>NetDev<span class="token punctuation">]</span>
<span class="token assign-left variable">Name</span><span class="token operator">=</span>br0
<span class="token assign-left variable">Kind</span><span class="token operator">=</span>bridge
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># /etc/systemd/network/10_bind.network </span>
<span class="token punctuation">[</span>Match<span class="token punctuation">]</span>
<span class="token assign-left variable">Name</span><span class="token operator">=</span>enp3s0

<span class="token punctuation">[</span>Network<span class="token punctuation">]</span>
<span class="token assign-left variable">Bridge</span><span class="token operator">=</span>br0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># /etc/systemd/network/20-wired.network</span>
<span class="token punctuation">[</span>Match<span class="token punctuation">]</span>
<span class="token assign-left variable">Name</span><span class="token operator">=</span>br0

<span class="token punctuation">[</span>Network<span class="token punctuation">]</span>
<span class="token assign-left variable">Address</span><span class="token operator">=</span><span class="token number">192.168</span>.11.13/24
<span class="token assign-left variable">Gateway</span><span class="token operator">=</span><span class="token number">192.168</span>.11.1
<span class="token assign-left variable">DNS</span><span class="token operator">=</span><span class="token number">114.114</span>.114.114
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> qemu-full libvirt virt-manager virt-viewer
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token parameter variable">--now</span> libvirtd.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编程环境" tabindex="-1"><a class="header-anchor" href="#编程环境" aria-hidden="true">#</a> 编程环境</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> jdk8-openjdk
<span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.pnpm.io/install.sh <span class="token operator">|</span> <span class="token function">sh</span> -
<span class="token function">pnpm</span> <span class="token function">env</span> use <span class="token parameter variable">--global</span> <span class="token number">16</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="有且只有一个kitty-打开并移动到当前工作区" tabindex="-1"><a class="header-anchor" href="#有且只有一个kitty-打开并移动到当前工作区" aria-hidden="true">#</a> 有且只有一个kitty，打开并移动到当前工作区</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yay <span class="token parameter variable">-S</span> wmctrl
wmctrl <span class="token parameter variable">-lx</span> <span class="token comment"># l代表列出，x代表class，加起来就是列出所有窗口的class</span>
<span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;wmctrl -x -R kitty.kitty || kitty&quot;</span> <span class="token comment"># 添加到全局快捷键里面，我用super+enter</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h1><p>[https://archlinuxstudio.github.io/ArchLinuxTutorial]<br> [https://snowfrs.com/2019/08/10/intall-archlinux-with-btrfs.html]<br> [https://xuanwo.io/2018/11/15/record-for-btrfs-conversion/]<br> [https://blog.kaaass.net/archives/1748]<br> [https://wiki.archlinux.org/]</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: jiyilc@chinatelecom.cn">季艺</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--[--><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-4ee05d6f.js" defer></script>
  </body>
</html>
